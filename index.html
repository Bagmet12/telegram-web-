<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Tesla Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://unpkg.com/quagga/dist/quagga.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen;
      background-color: #111;
      color: #fff;
      padding: 20px;
    }
    .header {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .subtext {
      font-size: 14px;
      color: #bbb;
    }
    .vin-display {
      font-size: 16px;
      font-weight: bold;
      margin: 5px 0 20px;
    }
    .scanner-area {
      position: relative;
      background: #1e1e1e;
      border-radius: 12px;
      padding: 12px;
      text-align: center;
      margin-bottom: 20px;
    }
    #video {
      width: 100%;
      border-radius: 8px;
      display: none;
    }
    .card {
      background-color: #1e1e1e;
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 12px;
      font-size: 15px;
      cursor: pointer;
    }
    .card strong {
      display: block;
      margin-bottom: 5px;
    }
    button, input {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      border: none;
      font-size: 16px;
    }
    button {
      background-color: #03c75a;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="header" id="greeting">–í—ñ—Ç–∞—î–º–æ!</div>
  <div class="subtext">–í–∞—à –ø–æ–¥–µ–∫—Ç–∏–≤–Ω VIN ‚Äî –∫–æ–Ω–Ω–µ–∫—Ç–æ–≤</div>
  <div class="vin-display" id="vin-display">–ù–µ –≤–∫–∞–∑–∞–Ω–æ</div>

  <div class="scanner-area">
    <input type="text" id="vin-input" placeholder="–û—Å—Ç–∞–Ω–Ω—ñ 6 —Å–∏–º–≤–æ–ª—ñ–≤ VIN" maxlength="6" oninput="updateVin(this.value)">
    <button onclick="startScan()">üì∑ –°–∫–∞–Ω—É–≤–∞—Ç–∏ VIN</button>
    <div id="interactive" class="viewport"></div>
  </div>

  <div class="card" onclick="showStatus()">
    <strong>üîß –°—Ç–∞—Ç—É—Å —Ä–µ–º–æ–Ω—Ç—É:</strong>
    <span id="status-text">–í –ø—Ä–æ—Ü–µ—Å—ñ</span>
  </div>

  <div class="card" onclick="downloadPDF()">
    <strong>üìÑ –û—Ç—Ä–∏–º–∞—Ç–∏ PDF –∑–≤—ñ—Ç</strong>
  </div>

  <div class="card" onclick="showContacts()">
    <strong>üìû –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</strong>
    <span>–¢–µ–ª–µ—Ñ–æ–Ω: +380 44 123 45 67<br>–ê–¥—Ä–µ—Å–∞: –º. –ö–∏—ó–≤, –≤—É–ª. –°–µ—Ä–≤—ñ—Å–Ω–∞ 10</span>
  </div>

  <div class="card" onclick="showErrors()">
    <strong>‚ö†Ô∏è –ü–æ—Ç–æ—á–Ω—ñ –ø–æ–º–∏–ª–∫–∏</strong>
    <span>‚Ä¢ P1234 ‚Äì –∑–Ω–∏–∂–µ–Ω–Ω—è –ø–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ (–º–æ–∂–Ω–∞ —ó—Ö–∞—Ç–∏)<br>‚Ä¢ P5678 ‚Äì –ø—Ä–æ–±–ª–µ–º–∞ –∑ –≥–∞–ª—å–º–∞–º–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –∑—É–ø–∏–Ω–∏—Ç–∏—Å—è)</span>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready(); tg.expand();
    const username = tg.initDataUnsafe?.user?.first_name || '–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á';
    document.getElementById('greeting').innerText = `–í—ñ—Ç–∞—î–º–æ, ${username}!`;

    function updateVin(val) {
      document.getElementById('vin-display').innerText = val || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ';
    }

    function startScan() {
      const scannerDiv = document.getElementById('interactive');
      document.getElementById('vin-input').value = '';
      Quagga.init({
        inputStream: {
          name: 'Live',
          type: 'LiveStream',
          target: scannerDiv,
          constraints: { facingMode: 'environment' }
        },
        decoder: { readers: ['code_128_reader'] },
        locate: true
      }, err => {
        if (err) {
          alert('–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Å–∫–∞–Ω–µ—Ä–∞: ' + err);
          return;
        }
        document.getElementById('interactive').style.display = 'block';
        Quagga.start();
      });

      Quagga.onDetected(result => {
        const code = result.codeResult.code;
        if (code && code.length >= 6) {
          const last6 = code.slice(-6);
          Quagga.stop();
          document.getElementById('interactive').style.display = 'none';
          document.getElementById('vin-input').value = last6;
          updateVin(last6);
        }
      });
    }

    function showStatus() { alert('–í–∞—à —Ä–µ–º–æ–Ω—Ç –Ω–∞—Ä–∞–∑—ñ –≤ –ø—Ä–æ—Ü–µ—Å—ñ.'); }
    function downloadPDF() { alert('–§—É–Ω–∫—Ü—ñ—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è PDF —É —Ä–æ–∑—Ä–æ–±—Ü—ñ.'); }
    function showContacts() { alert('–¢–µ–ª–µ—Ñ–æ–Ω: +380 44 123 45 67\n–ê–¥—Ä–µ—Å–∞: –ö–∏—ó–≤, –≤—É–ª. –°–µ—Ä–≤—ñ—Å–Ω–∞ 10'); }
    function showErrors() { alert('P1234: –∑–Ω–∏–∂–µ–Ω–Ω—è –ø–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ (–º–æ–∂–Ω–∞ —ó—Ö–∞—Ç–∏)\nP5678: –ø—Ä–æ–±–ª–µ–º–∞ –∑ –≥–∞–ª—å–º–∞–º–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –∑—É–ø–∏–Ω–∏—Ç–∏—Å—è)'); }
  </script>
</body>
</html>

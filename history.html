<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Історія заявок</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>/* ваш CSS */</style>
</head>
<body>
  <div class="history-container" id="history"></div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    async function fetchHistory(){
      const chatId = String(tg.initDataUnsafe.user.id);
      console.log("fetchHistory chatId=",chatId);
      try {
        const res = await fetch(`https://crm.dolce.kyiv.ua/api/get_requests?chat_id=${chatId}`);
        const body = await res.json();
        if(body.status==="ok") render(body.requests);
        else document.getElementById('history').innerText = body.message;
      } catch(e){
        document.getElementById('history').innerText = "Помилка завантаження";
      }
    }

    function render(list){
      const out = document.getElementById('history');
      out.innerHTML = "";
      list.forEach((r,i)=>{
        const div = document.createElement('div');
        div.innerHTML = `
          <b>Заявка №${i+1}</b><br>
          VIN: ${r.vin}<br>
          Дата: ${r.date}<br>
          Проблема: ${r.problem}<hr>
        `;
        out.append(div);
      });
    }

    fetchHistory();
  </script>
</body>
</html>
